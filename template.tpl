___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Channel.io",
  "categories": ["ANALYTICS", "CHAT", "CONVERSIONS", "MARKETING"],
  "brand": {
    "id": "channel",
    "displayName": "Channel.io",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDAyIDc5LjE2NDM2MCwgMjAyMC8wMi8xMy0wMTowNzoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpjMmM2YjQ2Mi1kNzE1LTRjYTYtODU2ZS02MzE2OTRmYTkxYzgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTYyRkU4RkE5OUE2MTFFQUI2OTVBMkQwNTBDQTk2RTciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTYyRkU4Rjk5OUE2MTFFQUI2OTVBMkQwNTBDQTk2RTciIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpjMmM2YjQ2Mi1kNzE1LTRjYTYtODU2ZS02MzE2OTRmYTkxYzgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6YzJjNmI0NjItZDcxNS00Y2E2LTg1NmUtNjMxNjk0ZmE5MWM4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"
  },
  "description": "Support easy integration of posting event to channel and controlling plugin.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "action",
    "displayName": "Action",
    "selectItems": [
      {
        "value": "track",
        "displayValue": "Track (Send event)"
      },
      {
        "value": "show",
        "displayValue": "Show (Show messenger)"
      },
      {
        "value": "hide",
        "displayValue": "Hide (Hide messenger)"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "eventName",
    "displayName": "Event Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "action",
        "paramValue": "track",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "STRING_LENGTH",
        "args": [
          1,
          64
        ]
      }
    ]
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "eventProperty",
    "displayName": "Event Property",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Key",
        "name": "key",
        "type": "TEXT",
        "isUnique": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "defaultValue": "",
        "displayName": "Value",
        "name": "value",
        "type": "TEXT",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "valueHint": ""
      }
    ],
    "enablingConditions": [
      {
        "paramName": "action",
        "paramValue": "track",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// require import
const log = require('logToConsole');
const getType = require('getType');
const copyFromWindow = require('copyFromWindow');
const ChannelIO = copyFromWindow('ChannelIO');

// logging data
// log('data =', data);

// util functions
function parseProperty(property) {
  if (getType(property) === 'array') {
    return property.reduce(function(obj, item) {
      const key = item.key;
      const value = item.value;

      obj[key] = value;

      return obj;
    }, {});
  }
  return null;
}

if (ChannelIO) {
  switch (data.action) {
    case 'track':
      ChannelIO('track', data.eventName, parseProperty(data.eventProperty));
      break;

    case 'show':
      ChannelIO('show');
      break;

    case 'hide':
      ChannelIO('hide');
      break;

    default:
      data.gtmOnFailure(log('Not supported action: ' + data.action));
      return;
  }
  data.gtmOnSuccess();
} else {
  data.gtmOnFailure(log("ChannelIO script is not installed in this page. Please check https://developers.channel.io/docs/web-installation"));
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ChannelIO"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 2020. 6. 3. 오전 11:37:22


